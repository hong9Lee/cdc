# CDC란?  

시스템에서 데이터가 변경된 것을 감지하여, 타깃 시스템이 변경 작업에 대응하는 작업을 수행하도록 하는 프로세스  
목적: 주문의 상태가 변경되었을때 메시지를 읽어 consumer에서 알림톡을 전송한다.  
- 기대 동작이 실패하게되면 service layer의 Db transaction과 kafka transaction 데이터 일관성은 어떻게 보장하는가에 대한 고민


### 1. Outbox 패턴  
db 트랜잭션 범위 내에서 "Outbox"라는 별도의 테이블에 메시지를 기록하고, 커밋 후 이 Outbox 테이블을 읽어 Kafka로 메시지를 전송.  
메시지 전송 실패 시 재시도 로직을 구성하여 안정성을 높일 수 있다.  
실무에서는 도메인 로직이 명확하게 실행되었지만 모종의 사유로 이벤트 발행에 실패한 것들은 별도의 배치 로직을 통해서 이벤트 재발행 시도를 하면 좋을 것 같다.  

### 2. Debezium을 이용한 CDC 구현  
db 변경 사항을 실시간으로 감지하고 db binlog를 읽어 Kafka와 같은 메시지 브로커에 이벤트로 전송한다.  
debezium connector가 기동될 시, 대상 테이블에 읽기 락을 건다.  
snapshot.mode 설정으로 스냅샷 옵션 변경이 가능하다.  
실무에서 사용한다면 재기동시 DML에 대한 레이턴시가 걸릴 수 있을 것 같다..! 
